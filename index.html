<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>공부 노트 블로그</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO / 메타 -->
  <meta name="description" content="AI, 언어학, 문학, 철학, 역사 공부 노트. 논문, 책, 수업 내용을 매일 한 편씩 정리하는 개인/연구 노트 블로그입니다." />
  <meta property="og:title" content="공부 노트 블로그 | Study Notes" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="AI · 언어학 · 문학 · 철학 · 역사 — 읽고, 요약하고, 다시 생각하기. 하루 한 편 발제 노트." />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- 상단 바 -->
  <header>
    <div class="top-bar">
      <div class="brand">STUDY LOG</div>
      <div class="top-actions">
        <a href="editor.html" class="editor-link">✎ 에디터</a>
        <button class="icon-button menu-toggle" aria-label="메뉴 열기">
          <span aria-hidden="true">☰</span>
        </button>
      </div>
    </div>
  </header>

  <!-- 사이드바 -->
  <div class="sidebar-backdrop"></div>
  <aside class="sidebar" aria-label="사이드바">
    <div class="sidebar-header">
      <span>Menu</span>
      <button class="icon-button menu-close" aria-label="닫기">✕</button>
    </div>
    <div class="sidebar-section">
      <h3>About</h3>
      <p>책, 논문, 수업에서 배운 내용을 정리하는 개인/연구 노트입니다.</p>
    </div>
    <div class="sidebar-section">
      <h3>Categories</h3>
      <ul>
        <li><button type="button" class="sidebar-category-button" data-category="AI / ML">AI / ML</button></li>
        <li><button type="button" class="sidebar-category-button" data-category="linguistics">언어학</button></li>
        <li><button type="button" class="sidebar-category-button" data-category="literature">문학</button></li>
        <li><button type="button" class="sidebar-category-button" data-category="philosophy">철학</button></li>
        <li><button type="button" class="sidebar-category-button" data-category="history">역사</button></li>
      </ul>
    </div>
    <!-- 사이드바 카테고리 글 목록 출력 영역 -->
    <div id="sidebar-category-posts" class="sidebar-posts"></div>
  </aside>

  <!-- 메인 -->
  <main>
    <section class="hero">
      <h1 class="hero-title">Daily Study Notes</h1>
      <p class="hero-subtitle">AI · 언어학 · 문학 · 철학 · 역사 — 읽고, 요약하고, 다시 생각하기.</p>
      <div class="hero-meta">
        <span>Reading · Writing · Thinking</span>
        <span>하루 한 편 발제 노트</span>
      </div>
    </section>

    <!-- Topics 버튼 & 필터 -->
    <nav class="category-bar" aria-label="글 카테고리">
      <span class="category-label">Topics</span>
      <div class="topic-buttons">
        <button type="button" class="topic-button active" data-category="all">전체</button>
        <!-- data-category를 "AI / ML"로 통일 -->
        <button type="button" class="topic-button" data-category="AI / ML">AI / ML</button>
        <button type="button" class="topic-button" data-category="linguistics">언어학</button>
        <button type="button" class="topic-button" data-category="literature">문학</button>
        <button type="button" class="topic-button" data-category="philosophy">철학</button>
        <button type="button" class="topic-button" data-category="history">역사</button>
      </div>
    </nav>

    <!-- Topics 아래 글 리스트 (최신 5개) -->
    <section class="section" id="topics-section">
      <h2 class="section-title">글 목록</h2>
      <ul class="post-list" id="topics-post-list">
        <!-- posts.json에서 동적으로 채워짐 -->
      </ul>
    </section>

    <!-- Today & Updates 섹션 -->
    <section class="section">
      <h2 class="section-title">Today & Updates</h2>
      <div class="section-grid">
        <div>
          <article class="featured">
            <div class="featured-label">오늘의 발제</div>
            <h3 class="featured-title">Attention Is All You Need (2017) — 핵심 아이디어 정리</h3>
            <div class="post-meta">2025-11-10 · AI / 논문 읽기 · 약 7분</div>
            <p class="summary-line">
              Self-attention 메커니즘과 인코더-디코더 구조를 중심으로, 기존 RNN 기반 모델과의 차이와 장점을 요약합니다.
            </p>
          </article>

          <h3 class="section-subheading section-subheading--spaced">최근 작성 글</h3>
          <ul class="post-list">
            <li class="post-item">
              <span class="post-item-title">언어 모델의 “의미 이해”는 무엇을 의미하나?</span>
              <span class="post-item-meta">2025-11-09 · AI, 언어철학 · 6분</span>
            </li>
            <li class="post-item">
              <span class="post-item-title">비트겐슈타인 『철학 탐구』 §1–20 발제</span>
              <span class="post-item-meta">2025-11-08 · 철학 · 8분</span>
            </li>
          </ul>
        </div>

        <div>
          <h3 class="section-subheading">공지사항</h3>
          <ul class="notice-list">
            <li class="notice-item">
              <span>업로드 규칙: “하루 한 편” 실험 시작</span>
              <span class="notice-meta">2025-11-01 · 블로그 운영</span>
            </li>
            <li class="notice-item">
              <span>새 카테고리: “논문 한 장 요약” 추가</span>
              <span class="notice-meta">2025-10-28 · 카테고리 안내</span>
            </li>
          </ul>
        </div>
      </div>
    </section>

        <!-- Daily Study / Workout Log -->
    <section class="section" id="daily-log-section">
      <h2 class="section-title">Daily Study / Workout Log</h2>

      <div class="daily-log-layout">
        <!-- 캘린더 패널 -->
        <div class="daily-calendar-panel">
          <div class="daily-log-header">
            <button type="button" class="daily-log-nav" data-dir="prev">←</button>
            <div class="daily-log-month-label" id="daily-log-month-label"></div>
            <button type="button" class="daily-log-nav" data-dir="next">→</button>
          </div>

          <div class="daily-calendar-grid" id="daily-calendar-grid">
            <!-- 요일 헤더 -->
            <div class="daily-calendar-day-label">일</div>
            <div class="daily-calendar-day-label">월</div>
            <div class="daily-calendar-day-label">화</div>
            <div class="daily-calendar-day-label">수</div>
            <div class="daily-calendar-day-label">목</div>
            <div class="daily-calendar-day-label">금</div>
            <div class="daily-calendar-day-label">토</div>
            <!-- 날짜 셀은 JS에서 채움 -->
          </div>

          <p class="daily-log-hint">
            · 점이 있는 날짜는 인증이 있는 날입니다. 날짜를 클릭하면 아래 피드가 해당 날짜로 필터링됩니다.
          </p>
        </div>

        <!-- 인스타그램 스타일 피드 -->
        <div class="daily-feed-panel">
          <h3 class="section-subheading">Daily Feed</h3>
          <div class="daily-feed-grid" id="daily-feed-grid">
            <!-- JS로 썸네일 카드 렌더링 -->
          </div>
          <p class="daily-log-empty" id="daily-log-empty" hidden>
            아직 업로드된 인증이 없습니다.
          </p>
          <p class="daily-log-selected-info" id="daily-log-selected-info" hidden></p>
        </div>
      </div>
    </section>
  </main>

  <!-- 이미지/글 상세 보기 모달 -->
  <div class="daily-log-modal-backdrop" id="daily-log-modal-backdrop">
    <div class="daily-log-modal" role="dialog" aria-modal="true" aria-labelledby="daily-log-modal-title">
      <button type="button" class="daily-log-modal-close" id="daily-log-modal-close">✕</button>
      <div class="daily-log-modal-image-wrap">
        <img src="" alt="" class="daily-log-modal-image" id="daily-log-modal-image" />
      </div>
      <div class="daily-log-modal-body">
        <h3 class="daily-log-modal-title" id="daily-log-modal-title"></h3>
        <p class="daily-log-modal-meta" id="daily-log-modal-meta"></p>
        <p class="daily-log-modal-text" id="daily-log-modal-text"></p>
      </div>
    </div>
  </div>

    
  </main>

  <!-- 푸터 -->
  <footer>
    <div class="footer-inner">
      <div class="footer-row">
        <span>© <span id="year"></span> Study Notes. All rights reserved.</span>
        <span><a href="mailto:you@example.com">you@example.com</a></span>
      </div>
      <div class="footer-row">
        <span>매일 한 편 업로드를 목표로 합니다.</span>
        <span><a href="#">RSS</a> · <a href="#">GitHub Repo</a> · <a href="#">CC BY-NC-SA</a></span>
      </div>
    </div>
  </footer>

  <script>
    // 푸터 연도 & 사이드바 토글
    document.getElementById("year").textContent = new Date().getFullYear();
    const sidebar = document.querySelector(".sidebar");
    const backdrop = document.querySelector(".sidebar-backdrop");
    const menuToggle = document.querySelector(".menu-toggle");
    const menuClose = document.querySelector(".menu-close");

    function openSidebar() {
      sidebar.classList.add("open");
      backdrop.classList.add("visible");
    }
    function closeSidebar() {
      sidebar.classList.remove("open");
      backdrop.classList.remove("visible");
    }
    menuToggle.addEventListener("click", openSidebar);
    menuClose.addEventListener("click", closeSidebar);
    backdrop.addEventListener("click", closeSidebar);

    // 글 데이터 로딩 & 렌더링
    const TOPIC_ALL = "all";
    let postsData = [];

    function getSortedPosts() {
      return postsData
        .slice()
        .sort((a, b) => {
          const da = new Date(a.date || 0);
          const db = new Date(b.date || 0);
          return db - da;
        });
    }

    function filterPostsByCategory(category) {
      const sorted = getSortedPosts();
      if (!category || category === TOPIC_ALL) return sorted;
      return sorted.filter(post => post.category === category);
    }

    // Topics 아래 글 리스트 렌더링 (최신 5개)
    function renderTopicPosts(category) {
      const listEl = document.getElementById("topics-post-list");
      if (!listEl) return;
      listEl.innerHTML = "";

      if (!postsData.length) {
        const li = document.createElement("li");
        li.className = "post-item";
        li.textContent = "불러온 글이 없습니다. posts/posts.json을 확인하세요.";
        listEl.appendChild(li);
        return;
      }

      const posts = filterPostsByCategory(category).slice(0, 5);
      if (!posts.length) {
        const li = document.createElement("li");
        li.className = "post-item";
        li.textContent = "이 토픽에 해당하는 글이 아직 없습니다.";
        listEl.appendChild(li);
        return;
      }

      posts.forEach(post => {
        const li = document.createElement("li");
        li.className = "post-item";

        const titleSpan = document.createElement("span");
        titleSpan.className = "post-item-title";
        const link = document.createElement("a");
        link.href = post.url || post.link || "#";
        link.textContent = post.title || "제목 없음";
        titleSpan.appendChild(link);

        const metaSpan = document.createElement("span");
        metaSpan.className = "post-item-meta";
        const parts = [];
        if (post.date) parts.push(post.date);
        if (post.category) parts.push(post.category);
        if (post.readingTime) parts.push(post.readingTime);
        metaSpan.textContent = parts.join(" · ");

        li.appendChild(titleSpan);
        li.appendChild(metaSpan);
        listEl.appendChild(li);
      });
    }

    // Topics 버튼 active 처리
    function setActiveTopicButton(activeCategory) {
      document.querySelectorAll(".topic-button").forEach(btn => {
        if (btn.dataset.category === activeCategory) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    function setupTopicButtons() {
      document.querySelectorAll(".topic-button").forEach(btn => {
        btn.addEventListener("click", () => {
          const category = btn.dataset.category || TOPIC_ALL;
          setActiveTopicButton(category);
          renderTopicPosts(category);
        });
      });
      setActiveTopicButton(TOPIC_ALL);
    }

    // 사이드바 카테고리 글 목록 렌더링 (현재는 카테고리 페이지로 이동)
    function renderSidebarCategoryPosts(category) {
      const container = document.getElementById("sidebar-category-posts");
      if (!container) return;
      container.innerHTML = "";

      if (!postsData.length) {
        const empty = document.createElement("div");
        empty.className = "sidebar-posts-empty";
        empty.textContent = "불러온 글이 없습니다. posts/posts.json을 확인하세요.";
        container.appendChild(empty);
        return;
      }

      const posts = filterPostsByCategory(category);
      if (!posts.length) {
        const empty = document.createElement("div");
        empty.className = "sidebar-posts-empty";
        empty.textContent = "이 카테고리의 글이 아직 없습니다.";
        container.appendChild(empty);
        return;
      }

      // 너무 길어지지 않도록 최대 10개만 표시
      posts.slice(0, 10).forEach(post => {
        const card = document.createElement("a");
        card.className = "sidebar-post-card";
        card.href = post.url || post.link || "#";

        if (post.thumbnail) {
          const img = document.createElement("img");
          img.className = "sidebar-post-thumb";
          img.src = post.thumbnail;
          img.alt = (post.title || "") + " 썸네일";
          card.appendChild(img);
        }

        const info = document.createElement("div");
        info.className = "sidebar-post-info";

        const titleEl = document.createElement("div");
        titleEl.className = "sidebar-post-title";
        titleEl.textContent = post.title || "제목 없음";

        const metaEl = document.createElement("div");
        metaEl.className = "sidebar-post-meta";
        const parts = [];
        if (post.date) parts.push(post.date);
        if (post.readingTime) parts.push(post.readingTime);
        metaEl.textContent = parts.join(" · ");

        info.appendChild(titleEl);
        info.appendChild(metaEl);
        card.appendChild(info);

        container.appendChild(card);
      });
    }

    function setActiveSidebarCategoryButton(activeCategory) {
      document.querySelectorAll(".sidebar-category-button").forEach(btn => {
        if (btn.dataset.category === activeCategory) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    function setupSidebarCategoryButtons() {
      document.querySelectorAll(".sidebar-category-button").forEach(btn => {
        btn.addEventListener("click", () => {
          const category = btn.dataset.category;
          const filename = "category-" + encodeURIComponent(category) + ".html";
          // categories 폴더로 경로 지정
          window.location.href = "categories/" + filename;
        });
      });
    }

    // posts.json 로드
    function initPosts() {
      fetch("posts/posts.json")
        .then(response => response.json())
        .then(data => {
          // 배열 또는 { posts: [...] } 둘 다 대응 (조금 더 안전하게)
          if (Array.isArray(data)) {
            postsData = data;
          } else if (Array.isArray(data?.posts)) {
            postsData = data.posts;
          } else {
            postsData = [];
          }
          renderTopicPosts(TOPIC_ALL); // 데이터 로드 후 다시 렌더
        })
        .catch(error => {
          console.error("posts.json 로드 실패:", error);
          postsData = [];
          renderTopicPosts(TOPIC_ALL);
          alert("게시글 데이터를 불러오지 못했습니다. posts/posts.json 파일을 확인해주세요.");
        });
    }

        // --- Daily Study / Workout Log ---

    const DAILY_LOG_CONFIG = {
      dataUrl: "daily/daily-logs.json", // 새로 만들 JSON 파일 경로
    };

    let dailyEntries = [];
    let dailyCurrentYear;
    let dailyCurrentMonth; // 0-based (0 = January)
    let dailySelectedDate = null;

    function normalizeDateStr(dateStr) {
      // "2025-11-03T..." 같은 것도 "2025-11-03"으로 통일
      return (dateStr || "").slice(0, 10);
    }

    function groupEntriesByDate(entries) {
      const map = {};
      entries.forEach(entry => {
        const key = normalizeDateStr(entry.date);
        if (!key) return;
        if (!map[key]) map[key] = [];
        map[key].push(entry);
      });
      return map;
    }

    function buildCalendar(year, month, entriesByDate) {
      const grid = document.getElementById("daily-calendar-grid");
      const monthLabel = document.getElementById("daily-log-month-label");
      if (!grid || !monthLabel) return;

      // 기존 날짜 셀 제거 (요일 헤더 7개만 남기고)
      while (grid.children.length > 7) {
        grid.removeChild(grid.lastChild);
      }

      const firstDay = new Date(year, month, 1);
      const startWeekday = firstDay.getDay(); // 0 = Sun
      const lastDayNum = new Date(year, month + 1, 0).getDate();

      monthLabel.textContent = `${year}. ${(month + 1).toString().padStart(2, "0")}`;

      // 앞쪽 빈 셀
      for (let i = 0; i < startWeekday; i++) {
        const emptyCell = document.createElement("div");
        emptyCell.className = "daily-calendar-cell empty";
        grid.appendChild(emptyCell);
      }

      // 날짜 셀
      for (let day = 1; day <= lastDayNum; day++) {
        const cellDate = new Date(year, month, day);
        const dateStr = cellDate.toISOString().slice(0, 10);
        const hasEntry = !!entriesByDate[dateStr];

        const cell = document.createElement("button");
        cell.type = "button";
        cell.className = "daily-calendar-cell";
        cell.dataset.date = dateStr;
        cell.textContent = String(day);

        if (hasEntry) {
          cell.classList.add("has-entry");
        }

        if (dailySelectedDate === dateStr) {
          cell.classList.add("selected");
        }

        cell.addEventListener("click", () => {
          if (dailySelectedDate === dateStr) {
            // 한 번 더 누르면 필터 해제
            dailySelectedDate = null;
          } else {
            dailySelectedDate = dateStr;
          }
          renderDailyFeed();
          // 선택 상태 재렌더
          document.querySelectorAll(".daily-calendar-cell").forEach(c => {
            if (c.dataset.date === dailySelectedDate) {
              c.classList.add("selected");
            } else {
              c.classList.remove("selected");
            }
          });
        });

        grid.appendChild(cell);
      }
    }

    function renderDailyFeed() {
      const container = document.getElementById("daily-feed-grid");
      const emptyEl = document.getElementById("daily-log-empty");
      const selectedInfoEl = document.getElementById("daily-log-selected-info");
      if (!container || !emptyEl || !selectedInfoEl) return;

      container.innerHTML = "";

      let visibleEntries = dailyEntries.slice();

      if (dailySelectedDate) {
        const normalized = normalizeDateStr(dailySelectedDate);
        visibleEntries = visibleEntries.filter(
          entry => normalizeDateStr(entry.date) === normalized
        );
        selectedInfoEl.hidden = false;
        selectedInfoEl.textContent = `${normalized} 인증만 표시 중입니다. (다시 날짜를 누르면 전체 보기)`;
      } else {
        selectedInfoEl.hidden = true;
      }

      if (!visibleEntries.length) {
        emptyEl.hidden = false;
        return;
      }

      emptyEl.hidden = true;

      visibleEntries.forEach(entry => {
        const card = document.createElement("button");
        card.type = "button";
        card.className = "daily-feed-item";
        card.dataset.date = normalizeDateStr(entry.date || "");

        const thumbWrap = document.createElement("div");
        thumbWrap.className = "daily-feed-thumb-wrap";

        if (entry.image) {
          const img = document.createElement("img");
          img.className = "daily-feed-thumb";
          img.src = entry.image;
          img.alt = (entry.title || "") + " 썸네일";
          thumbWrap.appendChild(img);
        } else {
          const placeholder = document.createElement("div");
          placeholder.className = "daily-feed-thumb placeholder";
          placeholder.textContent = "No Image";
          thumbWrap.appendChild(placeholder);
        }

        const meta = document.createElement("div");
        meta.className = "daily-feed-meta";

        const titleEl = document.createElement("div");
        titleEl.className = "daily-feed-title";
        titleEl.textContent = entry.title || "제목 없음";

        const dateEl = document.createElement("div");
        dateEl.className = "daily-feed-date";
        const parts = [];
        if (entry.date) parts.push(normalizeDateStr(entry.date));
        if (entry.type) parts.push(entry.type);
        meta.appendChild(titleEl);
        dateEl.textContent = parts.join(" · ");

        meta.appendChild(dateEl);

        card.appendChild(thumbWrap);
        card.appendChild(meta);

        card.addEventListener("click", () => openDailyModal(entry));

        container.appendChild(card);
      });
    }

    function openDailyModal(entry) {
      const backdrop = document.getElementById("daily-log-modal-backdrop");
      const imgEl = document.getElementById("daily-log-modal-image");
      const titleEl = document.getElementById("daily-log-modal-title");
      const metaEl = document.getElementById("daily-log-modal-meta");
      const textEl = document.getElementById("daily-log-modal-text");
      if (!backdrop || !imgEl || !titleEl || !metaEl || !textEl) return;

      if (entry.image) {
        imgEl.src = entry.image;
        imgEl.alt = (entry.title || "") + " 이미지";
      } else {
        imgEl.src = "";
        imgEl.alt = "";
      }

      titleEl.textContent = entry.title || "제목 없음";

      const parts = [];
      if (entry.date) parts.push(normalizeDateStr(entry.date));
      if (entry.type) parts.push(entry.type);
      metaEl.textContent = parts.join(" · ");

      textEl.textContent = entry.text || "";

      backdrop.classList.add("open");
    }

    function closeDailyModal() {
      const backdrop = document.getElementById("daily-log-modal-backdrop");
      if (!backdrop) return;
      backdrop.classList.remove("open");
    }

    function setupDailyModalEvents() {
      const backdrop = document.getElementById("daily-log-modal-backdrop");
      const closeBtn = document.getElementById("daily-log-modal-close");
      if (!backdrop || !closeBtn) return;

      closeBtn.addEventListener("click", closeDailyModal);
      backdrop.addEventListener("click", event => {
        if (event.target === backdrop) {
          closeDailyModal();
        }
      });

      document.addEventListener("keydown", event => {
        if (event.key === "Escape") {
          closeDailyModal();
        }
      });
    }

    function setupDailyMonthNav(entriesByDate) {
      const prevBtn = document.querySelector(".daily-log-nav[data-dir='prev']");
      const nextBtn = document.querySelector(".daily-log-nav[data-dir='next']");
      if (!prevBtn || !nextBtn) return;

      function rerender() {
        buildCalendar(dailyCurrentYear, dailyCurrentMonth, entriesByDate);
      }

      prevBtn.addEventListener("click", () => {
        if (dailyCurrentMonth === 0) {
          dailyCurrentMonth = 11;
          dailyCurrentYear -= 1;
        } else {
          dailyCurrentMonth -= 1;
        }
        rerender();
      });

      nextBtn.addEventListener("click", () => {
        if (dailyCurrentMonth === 11) {
          dailyCurrentMonth = 0;
          dailyCurrentYear += 1;
        } else {
          dailyCurrentMonth += 1;
        }
        rerender();
      });
    }

    function initDailyLog() {
      const today = new Date();
      dailyCurrentYear = today.getFullYear();
      dailyCurrentMonth = today.getMonth();

      setupDailyModalEvents();

      fetch(DAILY_LOG_CONFIG.dataUrl)
        .then(resp => resp.json())
        .then(data => {
          if (Array.isArray(data)) {
            dailyEntries = data;
          } else if (Array.isArray(data?.entries)) {
            dailyEntries = data.entries;
          } else {
            dailyEntries = [];
          }

          // 최근 날짜 기준으로 소팅 (가장 최근 것이 앞에 오도록)
          dailyEntries.sort((a, b) => {
            const da = new Date(a.date || 0);
            const db = new Date(b.date || 0);
            return db - da;
          });

          const entriesByDate = groupEntriesByDate(dailyEntries);
          buildCalendar(dailyCurrentYear, dailyCurrentMonth, entriesByDate);
          setupDailyMonthNav(entriesByDate);
          renderDailyFeed();
        })
        .catch(error => {
          console.error("daily-logs.json 로드 실패:", error);
          dailyEntries = [];
          renderDailyFeed();
        });
    }

    
    // 초기화
    setupTopicButtons();
    setupSidebarCategoryButtons();
    renderTopicPosts(TOPIC_ALL); // 데이터 로딩 전 기본 메시지
    initPosts();
    initDailyLog(); // ← Daily Log 초기화
  </script>

</body>
</html>
