<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cognitive Frame - 홈</title>
  <link rel="stylesheet" href="styles/styles.css"/>
</head>

<body>

<header class="header">
  <div class="header-left">
    <a href="index.html" class="logo">CognitiveFrame</a>
    <a href="editor.html" class="editor-link">✎ 에디터</a>
  </div>
  <button class="menu-button" aria-label="메뉴 열기" aria-expanded="false">☰</button>
</header>

<!-- 사이드바 -->
<aside class="sidebar">
  <nav class="sidebar-nav">
    <ul>
      <li><span class="sidebar-section-title">About</span></li>
      <li><a href="about.html">우리의 목표</a></li>
    </ul>

    <ul>
      <li><span class="sidebar-section-title">Categories</span></li>
      <li><button class="sidebar-category-button" data-category="ai-ml">AI / ML</button></li>
      <li><button class="sidebar-category-button" data-category="linguistics">언어학</button></li>
      <li><button class="sidebar-category-button" data-category="literature">문학</button></li>
      <li><button class="sidebar-category-button" data-category="philosophy">철학</button></li>
      <li><button class="sidebar-category-button" data-category="history">역사</button></li>
    </ul>

    <ul>
      <li><span class="sidebar-section-title">Posts</span></li>
      <li><div id="sidebar-posts-list" class="sidebar-posts-list"></div></li>
    </ul>
  </nav>
</aside>

<!-- 본문 영역 -->
<main class="container">
  <section class="hero">
    <h1 class="hero-title">Cognitive Frame</h1>
    <p class="hero-subtitle">AI — Cognitive Science — Language — Humanities</p>
    <p class="hero-meta">지식의 구조와 인식의 프레임을 탐구합니다.</p>
  </section>

  <section>
    <h2 class="section-title">Topics</h2>

    <div class="topics">
      <button type="button" class="topic-button active" data-category="all">전체</button>
      <button type="button" class="topic-button" data-category="ai-ml">AI / ML</button>
      <button type="button" class="topic-button" data-category="linguistics">언어학</button>
      <button type="button" class="topic-button" data-category="literature">문학</button>
      <button type="button" class="topic-button" data-category="philosophy">철학</button>
      <button type="button" class="topic-button" data-category="history">역사</button>
    </div>

    <ul id="posts-list" class="posts-list"></ul>
  </section>

  <section class="today-updates">
    <h2 class="section-title">Today & Updates</h2>

    <div class="today-card">
      <h3 class="card-title">Today’s Insight</h3>
      <p>오늘의 발제는 AI 모델의 수학적 표현 구조입니다.</p>
    </div>

    <div class="recent-card">
      <h3 class="card-title">Recent Posts</h3>
      <p>최근 작성된 글을 주기적으로 업데이트합니다.</p>
    </div>

    <div class="notice-card">
      <h3 class="card-title">Notice</h3>
      <p>이 블로그는 실험적 글쓰기 프레임워크입니다.</p>
    </div>
  </section>
</main>

<!-- 자바스크립트 -->
<script>
  const TOPIC_ALL = "all";
  let postsData = [];

  document.addEventListener("DOMContentLoaded", () => {
    setupMenu();
    setupTopicButtons();
    setupSidebarCategoryButtons();
    renderTopicPosts(TOPIC_ALL);
    initPosts();
  });

  function setupMenu() {
    const menuButton = document.querySelector(".menu-button");
    const sidebar = document.querySelector(".sidebar");

    menuButton.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      const expanded = sidebar.classList.contains("open");
      menuButton.setAttribute("aria-expanded", expanded);
    });
  }

  function initPosts() {
    fetch("posts/posts.json")
      .then(res => res.json())
      .then(data => {
        postsData = Array.isArray(data) ? data : [];
        renderSidebarCategoryPosts("ai-ml");
        renderTopicPosts(TOPIC_ALL);
      })
      .catch(error => {
        console.error("posts.json 로드 실패:", error);
        postsData = [];
        renderTopicPosts(TOPIC_ALL);
        renderSidebarCategoryPosts("ai-ml");
      });
  }

  /* ---- 정렬 & 필터 ---- */
  function getSortedPosts() {
    return [...postsData].sort((a, b) => new Date(b.date) - new Date(a.date));
  }

  function filterPostsByCategory(category) {
    const sorted = getSortedPosts();
    if (!category || category === TOPIC_ALL) return sorted;
    return sorted.filter(post => post.category === category);
  }

  /* ---- 메인 토픽 렌더 ---- */
  function renderTopicPosts(category = TOPIC_ALL) {
    const list = document.getElementById("posts-list");
    const filtered = filterPostsByCategory(category);

    if (!filtered.length) {
      list.innerHTML = `<li class="empty-message">불러온 글이 없습니다. posts/posts.json을 확인하세요.</li>`;
      return;
    }

    list.innerHTML = filtered.slice(0, 5).map(post =>
      `<li class="post-item">
        <a href="posts/${post.filename}">${post.title}</a>
        <span class="post-date">${post.date}</span>
      </li>`
    ).join("");
  }

  function setupTopicButtons() {
    document.querySelectorAll(".topic-button").forEach(btn => {
      btn.addEventListener("click", () => {
        const category = btn.dataset.category;
        document.querySelectorAll(".topic-button")
          .forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        renderTopicPosts(category);
      });
    });
  }

  /* ---- 사이드바 렌더 ---- */
  function renderSidebarCategoryPosts(category) {
    const list = document.getElementById("sidebar-posts-list");
    const filtered = filterPostsByCategory(category);

    if (!filtered.length) {
      list.innerHTML = `<p class="empty-message">해당 카테고리의 글이 없습니다.</p>`;
      return;
    }

    list.innerHTML = filtered.slice(0, 10).map(post =>
      `<a class="sidebar-post-link" href="posts/${post.filename}">${post.title}</a>`
    ).join("");
  }

  function setupSidebarCategoryButtons() {
    document.querySelectorAll(".sidebar-category-button").forEach(btn => {
      btn.addEventListener("click", () => {
        const category = btn.dataset.category;
        renderSidebarCategoryPosts(category);
        renderTopicPosts(category);
        document.querySelector(".sidebar").classList.remove("open");
      });
    });
  }
</script>

</body>
</html>
